<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>PyEnv (infer.PythonFrontend.PyEnv)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">infer</a> &#x00BB; <a href="../index.html">PythonFrontend</a> &#x00BB; PyEnv</nav><header class="odoc-preamble"><h1>Module <code><span>PythonFrontend.PyEnv</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-T"><a href="#module-T" class="anchor"></a><code><span><span class="keyword">module</span> T</span><span> = <a href="../../Textuallib/Textual/index.html">Textuallib.Textual</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-DataStack"><a href="#module-DataStack" class="anchor"></a><code><span><span class="keyword">module</span> <a href="DataStack/index.html">DataStack</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>In Python, everything is an object, and the interpreter maintains a stack of references to such objects. Pushing and popping on the stack are always references to objets that leave in a heap. There is no need to model this heap, but the data stack is quite important.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-info"><a href="#type-info" class="anchor"></a><code><span><span class="keyword">type</span> info</span><span> = </span><span>{</span></code><ol><li id="type-info.is_code" class="def record field anchored"><a href="#type-info.is_code" class="anchor"></a><code><span>is_code : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>is the entity a function / method ?</p><span class="comment-delim">*)</span></div></li><li id="type-info.is_class" class="def record field anchored"><a href="#type-info.is_class" class="anchor"></a><code><span>is_class : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>is the entity a class ?</p><span class="comment-delim">*)</span></div></li><li id="type-info.typ" class="def record field anchored"><a href="#type-info.typ" class="anchor"></a><code><span>typ : <a href="../../Textuallib/Textual/Typ/index.html#type-t">T.Typ.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Type annotation, if any (otherwise, <code>object</code> is used)</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Type information about various entities (toplevel declarations, temporaries, ...).</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-SMap"><a href="#module-SMap" class="anchor"></a><code><span><span class="keyword">module</span> SMap</span><span> : <span class="xref-unresolved">IStdlib</span>.IStd.Caml.Map.S <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">key</span> = <span class="xref-unresolved">string</span></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Symbol"><a href="#module-Symbol" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Symbol/index.html">Symbol</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Import"><a href="#module-Import" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Import/index.html">Import</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Global environment used during bytecode processing. Stores common global information like the toplevel symbols processed so far, or more local ones like the set of labels or variable ids currently used by a declaration.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Label"><a href="#module-Label" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Label/index.html">Label</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loc"><a href="#val-loc" class="anchor"></a><code><span><span class="keyword">val</span> loc : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Textuallib/Textual/Location/index.html#type-t">T.Location.t</a></span></code></div><div class="spec-doc"><p>Return the last recorded line information from the Python code-unit, if any.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stack"><a href="#val-stack" class="anchor"></a><code><span><span class="keyword">val</span> stack : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="DataStack/index.html#type-t">DataStack.t</a></span></code></div><div class="spec-doc"><p>Returns the <code>DataStack.t</code> for the current declaration</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-globals"><a href="#val-globals" class="anchor"></a><code><span><span class="keyword">val</span> globals : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Symbol/index.html#type-t">Symbol.t</a> <span class="xref-unresolved">SMap</span>.t</span></span></code></div><div class="spec-doc"><p>Return the <code>globals</code> map</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_used_builtins"><a href="#val-get_used_builtins" class="anchor"></a><code><span><span class="keyword">val</span> get_used_builtins : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../PyBuiltin/Set/index.html#type-t">PyBuiltin.Set.t</a></span></code></div><div class="spec-doc"><p>Return a set of <code>Builtin</code> the we spotted in the code</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-instructions"><a href="#val-instructions" class="anchor"></a><code><span><span class="keyword">val</span> instructions : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Textuallib/Textual/Instr/index.html#type-t">T.Instr.t</a> list</span></span></code></div><div class="spec-doc"><p>Returns the list of all instructions recorded for the current code unit</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-label_of_offset"><a href="#val-label_of_offset" class="anchor"></a><code><span><span class="keyword">val</span> label_of_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="Label/index.html#type-info">Label.info</a> option</span></span></code></div><div class="spec-doc"><p>Check if the instruction is a possible jump location, and return the label information found there, if any.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mk_fresh_ident"><a href="#val-mk_fresh_ident" class="anchor"></a><code><span><span class="keyword">val</span> mk_fresh_ident : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <a href="../../Textuallib/Textual/Ident/index.html#type-t">T.Ident.t</a></span></code></div><div class="spec-doc"><p>Generate a fresh temporary name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_ident_info"><a href="#val-get_ident_info" class="anchor"></a><code><span><span class="keyword">val</span> get_ident_info : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Textuallib/Textual/Ident/index.html#type-t">T.Ident.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-info">info</a> option</span></span></code></div><div class="spec-doc"><p>Get back the information of a temporary</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mk_fresh_label"><a href="#val-mk_fresh_label" class="anchor"></a><code><span><span class="keyword">val</span> mk_fresh_label : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * string</span></code></div><div class="spec-doc"><p>Generate a fresh label name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span>f:<span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>env:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <span><span class="type-var">'b</span> list</span></span></code></div><div class="spec-doc"><p>Similar to <code>List.map</code> but an <code>env</code> is threaded along the way</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enter_proc"><a href="#val-enter_proc" class="anchor"></a><code><span><span class="keyword">val</span> enter_proc : <span>is_toplevel:bool <span class="arrow">&#45;&gt;</span></span> <span>module_name:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Set the environment when entering a new code unit (like reset the instruction buffer, or id/label generators.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enter_node"><a href="#val-enter_node" class="anchor"></a><code><span><span class="keyword">val</span> enter_node : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Set the environment when entering a new node. Reset the <code>instructions</code> buffer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reset_stack"><a href="#val-reset_stack" class="anchor"></a><code><span><span class="keyword">val</span> reset_stack : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Reset the <code>stack</code> field of a <code>node</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_last_line"><a href="#val-update_last_line" class="anchor"></a><code><span><span class="keyword">val</span> update_last_line : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int option</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Update the <code>last_line</code> field of an env, if new information is availbe.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-push"><a href="#val-push" class="anchor"></a><code><span><span class="keyword">val</span> push : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="DataStack/index.html#type-cell">DataStack.cell</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Push a new <code>DataStack.cell</code> on the datastack</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop"><a href="#val-pop" class="anchor"></a><code><span><span class="keyword">val</span> pop : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-t">t</a> * <a href="DataStack/index.html#type-cell">DataStack.cell</a>)</span> option</span></span></code></div><div class="spec-doc"><p>Pop a <code>DataStack.cell</code> from the datastack, if any is available</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peek"><a href="#val-peek" class="anchor"></a><code><span><span class="keyword">val</span> peek : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="DataStack/index.html#type-cell">DataStack.cell</a> option</span></span></code></div><div class="spec-doc"><p>Peek a <code>DataStack.cell</code> from the datastack, if any is available</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-push_instr"><a href="#val-push_instr" class="anchor"></a><code><span><span class="keyword">val</span> push_instr : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Textuallib/Textual/Instr/index.html#type-t">T.Instr.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Record a new instruction for the current code unit</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_label"><a href="#val-register_label" class="anchor"></a><code><span><span class="keyword">val</span> register_label : <span>offset:int <span class="arrow">&#45;&gt;</span></span> <span><a href="Label/index.html#type-info">Label.info</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Register the fact that a new label <code>info</code> must be inserted before the instruction at <code>offset</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-process_label"><a href="#val-process_label" class="anchor"></a><code><span><span class="keyword">val</span> process_label : <span>offset:int <span class="arrow">&#45;&gt;</span></span> <span><a href="Label/index.html#type-info">Label.info</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Mark the label <code>info</code> at <code>offset</code> as processed</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_symbol"><a href="#val-register_symbol" class="anchor"></a><code><span><span class="keyword">val</span> register_symbol : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>global:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="Symbol/index.html#type-t">Symbol.t</a> <span class="arrow">&#45;&gt;</span></span> bool * <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Register a name (function, variable, ...). It might be a <code>global</code> symbol at the module level or in a local object. Also returns if the symbol was already bound</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup_symbol"><a href="#val-lookup_symbol" class="anchor"></a><code><span><span class="keyword">val</span> lookup_symbol : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>global:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="Symbol/index.html#type-t">Symbol.t</a> option</span></span></code></div><div class="spec-doc"><p>Lookup information about a global/local symbol previously registered via <code>register_symbol</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_call"><a href="#val-register_call" class="anchor"></a><code><span><span class="keyword">val</span> register_call : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Register a function call. It enables us to deal correctly with builtin declaration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mk_builtin_call"><a href="#val-mk_builtin_call" class="anchor"></a><code><span><span class="keyword">val</span> mk_builtin_call : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../PyBuiltin/index.html#type-textual">PyBuiltin.textual</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Textuallib/Textual/Exp/index.html#type-t">T.Exp.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a> * <a href="../../Textuallib/Textual/Ident/index.html#type-t">T.Ident.t</a> * <a href="../../Textuallib/Textual/Typ/index.html#type-t">T.Typ.t</a></span></code></div><div class="spec-doc"><p>Wrapper to compute the Textual version of a call to a &quot;textual&quot; builtin * function (a builtin we introduced for modeling purpose)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_function"><a href="#val-register_function" class="anchor"></a><code><span><span class="keyword">val</span> register_function : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Textuallib/Textual/Location/index.html#type-t">T.Location.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../PyCommon/index.html#type-annotated_name">PyCommon.annotated_name</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Register a function declaration. We keep track of them since they might shadow Python builtins or previous definitions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_method"><a href="#val-register_method" class="anchor"></a><code><span><span class="keyword">val</span> register_method : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>enclosing_class:string <span class="arrow">&#45;&gt;</span></span>
  <span>method_name:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../PyCommon/index.html#type-annotated_name">PyCommon.annotated_name</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Register a method declaration. We mostly keep track of their signatures</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup_signature"><a href="#val-lookup_signature" class="anchor"></a><code><span><span class="keyword">val</span> lookup_signature : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Textuallib/Textual/index.html#type-enclosing_class">T.enclosing_class</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Textuallib/Textual/ProcName/index.html#type-t">T.ProcName.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../PyCommon/index.html#type-annotated_name">PyCommon.annotated_name</a> list</span> option</span></span></code></div><div class="spec-doc"><p>Lookup the signature of a function / method</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_class"><a href="#val-register_class" class="anchor"></a><code><span><span class="keyword">val</span> register_class : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Register a class declaration (based on <code>LOAD_BUILD_CLASS</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_declared_classes"><a href="#val-get_declared_classes" class="anchor"></a><code><span><span class="keyword">val</span> get_declared_classes : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_import"><a href="#val-register_import" class="anchor"></a><code><span><span class="keyword">val</span> register_import : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Import/index.html#type-t">Import.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Register a import declaration (based on <code>IMPORT_NAME</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_textual_imports"><a href="#val-get_textual_imports" class="anchor"></a><code><span><span class="keyword">val</span> get_textual_imports : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Textuallib/Textual/Module/index.html#type-decl">T.Module.decl</a> list</span></span></code></div><div class="spec-doc"><p>Get back the list of registered imports</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_toplevel"><a href="#val-is_toplevel" class="anchor"></a><code><span><span class="keyword">val</span> is_toplevel : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Are we processing top level instructions, or something in a function/class ?</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-module_name"><a href="#val-module_name" class="anchor"></a><code><span><span class="keyword">val</span> module_name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Returns the name of the current module</p></div></div></div></body></html>